@page "/editmovie"
@using Models
@inject NavigationManager NavigationManager

<PageTitle>Add Movie</PageTitle>

<h3>Add Movie</h3>

<EditForm Model="@_movie" FormName="editMovie" OnSubmit="HandleSubmit">
    <form>
        <div class="mb-3">
            <label for="nimi" class="form-label">Nimi</label>
            <InputText id="nimi" @bind-Value="_movie.Nimi" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="ohjaaja" class="form-label">Ohjaaja</label>
            <InputText id="ohjaaja" @bind-Value="_movie.Ohjaaja" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="julkaistu" class="form-label">Julkaistu</label>
            <InputNumber id="julkaistu" @bind-Value="_movie.Julkaistu" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="pituus" class="form-label">Pituus</label>
            <InputNumber id="pituus" @bind-Value="_movie.Pituus" class="form-control" />
            <div class="form-text">Pituus minutes</div>
        </div>

        <div class="mb-3">
            <label for="arvio" class="form-label">Arvio</label>
            <InputText id="arvio" @bind-Value="_movie.Arvio" class="form-control" />
            <div class="form-text">Arvio IMDB</div>
        </div>

        <div class="mb-3">
            <label for="genre" class="form-label">Genre</label>
            <InputText id="genre" @bind-Value="_movie.Genre" class="form-control" />
            <div class="form-text">Movie's genre</div>
        </div>

        <div class="mb-3">
            <label for="päänäyttelijät" class="form-label">Päänäyttelijät</label>
            <InputText id="päänäyttelijät" @bind-Value="_movie.Päänäyttelijät" class="form-control" />
            <div class="form-text">Movie's lead actors</div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</EditForm>

@code {
    private Movie _movie { get; set; } = new Movie("");

    private Database _database;

    protected override void OnInitialized()
    {
        // Initialize Database with your connection string
        _database = new Database("Server=10.146.4.49;Port=3306;Database=moviedb;Uid=app;Pwd=databaseApp!;");
    }

    private async Task HandleSubmit()
    {
        if (!string.IsNullOrEmpty(_movie.Nimi) && !_database.CheckMovies(_movie))
        {
            _database.InsertMovie(_movie);
        }
        NavigationManager.NavigateTo("/movies");
    }
}

